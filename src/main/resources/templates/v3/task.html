<!DOCTYPE html>
<html lang="en" data-layout-mode="detached" data-bs-theme="dark">
    <head>
        <meta charset="utf-8" />
        <title th:text="${project.getProject().getTitle()}"/>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

        <!-- App favicon -->
        <link rel="shortcut icon" th:href="@{/v3/images/favicon.ico}">

        <!-- Theme Config Js -->
        <script th:src="@{/v3/js/hyper-config.js}"></script>

        <!-- App css -->
        <link th:href="@{/v3/css/app-creative.min.css}" rel="stylesheet" type="text/css" id="app-style" />

        <!-- Icons css -->
        <link th:href="@{/v3/css/icons.min.css}" rel="stylesheet" type="text/css" />

        <!-- Datatables css -->
        <link th:href="@{/v3/vendor/datatables.net-bs5/css/dataTables.bootstrap5.min.css}" rel="stylesheet" type="text/css" />
        <link th:href="@{/v3/vendor/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css}" rel="stylesheet" type="text/css" />

        <link rel="stylesheet" th:href="@{/v2/css/chat.css}">
    </head>

    <body>
    <!-- Begin page -->
    <div class="wrapper">

        <div th:insert="~{partials/v3-fragments :: nav-modal}"></div>

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->

        <div class="content-page">

            <p hidden="hidden" id="project-id" th:text="${project.getProject.getProjectId}"></p>

            <div class="content">

                <div class="offcanvas offcanvas-end" tabindex="-1" id="taskOffcanvas" aria-labelledby="offcanvasRightLabel">
                    <div class="offcanvas-header">
                        <h5 id="offcanvasRightLabel">Offcanvas right</h5>
                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <div class="row">
                            <div class="col">
                                <div class="card border-success border">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <h5 class="card-title text-success" id="offcanvasTaskTitle"></h5>
                                            <div class="d-flex align-items-center">
                                                <button class="dropdown-item" id="offcanvasTaskStatus" onclick="changeStatus(this)">
                                                    <span class="badge badge text-bg-primary">Назначенно</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body mb-0">
                                            <p class="card-text" id="offcanvasTaskDescribe"></p>
                                            <p class="mb-0">
                                                <img th:src="@{/v3/images/users/avatar-5.jpg}" alt="user-img" class="avatar-xs rounded-circle me-1">
                                                <span class="align-middle" id="offcanvasTaskAuthor"></span>
                                            </p>
                                            <p class="card-text"><b>Исполнители</b></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <h5>Комментарии</h5>
                                <div id="chat"></div>
                            </div>
                        </div>
                    </div>
                    <div class="offcanvas-bottom d-flex justify-content-center mb-4 mt-4">
                        <div class="container-fluid">
                            <div class="col">
                                <div class="row">
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="comment-input" placeholder="Сообщение..." aria-label="Comment message" aria-describedby="button-addon2">
                                        <button class="btn btn btn-light" type="button" id="button-addon2" onclick="sendComment()">
                                            <img src="/img/send.png" width="20" height="20">
                                        </button>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col d-flex justify-content-center">
                                        <button type="button" class="btn btn-primary" data-bs-dismiss="offcanvas" aria-label="Close">Закрыть</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Start Content-->
                <div class="container-fluid">
                    <div class="row mt-2">
                        <div class="col">
                            <div class="board">
                                <div class="tasks">
                                    <h5 class="mt-0 task-header">Назначено</h5>
                                    <div id="task-list-one" class="task-list-items">
                                        <div th:each="task : ${project.getTasksByStatus('ASSIGNED')}" class="card mb-0">
                                            <div class="card-body p-3">
                                                <small class="float-end text-muted" th:text="${task.getCreationDate()}"/>
                                                <span class="badge text-bg-primary">Назначено</span>

                                                <h5 class="mt-2 mb-2">
                                                    <a href="#" class="text-body" th:id="${task.getTaskId}" onclick="offcanvasTest(this)" th:text="${task.getTitle}"/>
                                                </h5>

                                                <p class="mb-0">
                                                        <span class="pe-2 text-nowrap mb-2 d-inline-block">
                                                            <i class="mdi mdi-briefcase-outline text-muted"></i>
                                                            Hyper
                                                        </span>
                                                    <span class="text-nowrap mb-2 d-inline-block">
                                                            <i class="mdi mdi-comment-multiple-outline text-muted"></i>
                                                            <b th:text="${task.getCommentList().size()}"/> Комментариев
                                                        </span>
                                                </p>

                                                <p class="mb-0">
                                                    <img th:src="@{/v3/images/users/avatar-5.jpg}" alt="user-img" class="avatar-xs rounded-circle me-1">
                                                    <span class="align-middle" th:text="${task.getAuthor}"/>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tasks">
                                    <h5 class="mt-0 task-header">В работе</h5>
                                    <div id="task-list-two" class="task-list-items">
                                        <div th:each="task : ${project.getTasksByStatus('IN_WORK')}" class="card mb-0">
                                            <div class="card-body p-3">
                                                <small class="float-end text-muted" th:text="${task.getCreationDate()}"/>
                                                <span class="badge text-bg-warning">В работе</span>

                                                <h5 class="mt-2 mb-2">
                                                    <a href="#" class="text-body" th:id="${task.getTaskId}" onclick="offcanvasTest(this)" th:text="${task.getTitle}"/>
                                                </h5>

                                                <p class="mb-0">
                                                        <span class="pe-2 text-nowrap mb-2 d-inline-block">
                                                            <i class="mdi mdi-briefcase-outline text-muted"></i>
                                                            Hyper
                                                        </span>
                                                    <span class="text-nowrap mb-2 d-inline-block">
                                                            <i class="mdi mdi-comment-multiple-outline text-muted"></i>
                                                            <b th:text="${task.getCommentList().size()}"/> Комментариев
                                                        </span>
                                                </p>

                                                <p class="mb-0">
                                                    <img th:src="@{/v3/images/users/avatar-5.jpg}" alt="user-img" class="avatar-xs rounded-circle me-1">
                                                    <span class="align-middle" th:text="${task.getAuthor}"/>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tasks">
                                    <h5 class="mt-0 task-header">Завершено</h5>
                                    <div id="task-list-three" class="task-list-items">
                                        <!-- Task Item -->
                                        <div th:each="task : ${project.getTasksByStatus('DONE')}" class="card mb-0">
                                            <div class="card-body p-3">
                                                <small class="float-end text-muted" th:text="${task.getCreationDate()}"/>
                                                <span class="badge text-bg-success">Завершено</span>

                                                <h5 class="mt-2 mb-2">
                                                    <a href="#" class="text-body" th:id="${task.getTaskId}" onclick="offcanvasTest(this)" th:text="${task.getTitle}"/>
                                                </h5>

                                                <p class="mb-0">
                                                        <span class="pe-2 text-nowrap mb-2 d-inline-block">
                                                            <i class="mdi mdi-briefcase-outline text-muted"></i>
                                                            Hyper
                                                        </span>
                                                    <span class="text-nowrap mb-2 d-inline-block">
                                                            <i class="mdi mdi-comment-multiple-outline text-muted"></i>
                                                            <b th:text="${task.getCommentList().size()}"/> Комментариев
                                                        </span>
                                                </p>

                                                <p class="mb-0">
                                                    <img th:src="@{/v3/images/users/avatar-5.jpg}" alt="user-img" class="avatar-xs rounded-circle me-1">
                                                    <span class="align-middle" th:text="${task.getAuthor}"/>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-6">
                            <div th:if="${curator} OR ${admin}" class="accordion mb-2" id="accordionExample">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingOne">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                            Добавить задачу
                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                                         data-bs-parent="#accordionExample">
                                        <div class="accordion-body">
                                            <div class="col-auto">
                                                <label for="taskTitle" class="col-form-label">Название задачи</label>
                                            </div>
                                            <div class="col-auto">
                                                <input type="text" id="taskTitle" class="form-control">
                                            </div>

                                            <div class="col-auto">
                                                <label for="taskDescribe" class="col-form-label">Описание задачи</label>
                                            </div>
                                            <div class="col-auto">
                                                <input type="text" id="taskDescribe" class="form-control">
                                            </div>

                                            <div class="col-auto">
                                                <label for="taskTargetDate" class="col-form-label">Время выполнения</label>
                                            </div>
                                            <div class="col-auto d-flex justify-content-center">
                                                <input id="taskTargetDate" type="hidden" data-inline="true" data-time="true" class="form-control">
                                            </div>

                                            <div class="col-auto">
                                                <label for="formFile" class="col-form-label">Файлы</label>
                                                <input class="form-control" type="file" id="formFile" multiple>
                                            </div>

                                            <div class="btn-group mt-3 mb-3" role="group" aria-label="Button group with nested dropdown">
                                                <div class="btn-group" role="group">
                                                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                        Исполнители
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <li th:each="user : ${project.getProject.getUserList}">
                                                            <div class="dropdown-item">
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox" th:id="'userCheck-' + ${user.getUserId}"
                                                                           onclick="this.setAttribute('value', this.value * -1)" value='-1'>
                                                                    <label class="form-check-label" th:for="'userCheck-' + ${user.getUserId}" th:text="${user.getUsername}"/>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <button type="button" class="btn btn-info" onclick="createTask()">Создать задачу</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

<!--                            <div th:if="${curator} OR ${admin}" th:each="task : ${project.getProjectTaskList}">-->
<!--                                <div class="card border-secondary border">-->
<!--                                    <div class="card-body">-->
<!--                                        <h5 class="card-title" th:text="${task.getTitle}"/>-->
<!--                                        <p class="mb-0">-->
<!--                                            Автор:-->
<!--                                            <img th:src="@{/v3/images/users/avatar-5.jpg}" alt="user-img" class="avatar-xs rounded-circle me-1">-->
<!--                                            <span class="align-middle" th:text="${task.getAuthor}"/>-->
<!--                                        </p>-->
<!--                                        <button class="btn btn-primary mt-2 mt-md-0" type="button" th:id="${task.getTaskId}" onclick="offcanvasTest(this)">Подробнее</button>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->

<!--                            <div th:unless="${curator} OR ${admin}" th:each="task : ${project.getUserTaskList}">-->
<!--                                <div class="card border-secondary border">-->
<!--                                    <div class="card-body">-->
<!--                                        <h5 class="card-title" th:text="${task.getTitle}"/>-->
<!--                                        <p class="mb-0">-->
<!--                                            Автор:-->
<!--                                            <img th:src="@{/v3/images/users/avatar-5.jpg}" alt="user-img" class="avatar-xs rounded-circle me-1">-->
<!--                                            <span class="align-middle" th:text="${task.getAuthor}"/>-->
<!--                                        </p>-->
<!--                                        <button class="btn btn-primary mt-2 mt-md-0" type="button" th:id="${task.getTaskId}" onclick="offcanvasTest(this)">Подробнее</button>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
                        </div>
                        <div class="col-xl-6 mb-5">
                            <div class="row">
                                <div class="col">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3>Участники</h3>
                                        </div>
                                        <div class="card-body">
                                            <div th:each="user : ${project.getProject.getUserList}">
                                                <p th:text="${user.getUsername}"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- container -->
            </div>
            <!-- content -->

            <!-- Footer Start -->
            <footer class="footer mt-2">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-6">
                            <script>document.write(new Date().getFullYear())</script> © Hyper - Coderthemes.com
                        </div>
                        <div class="col-md-6">
                            <div class="text-md-end footer-links d-none d-md-block">
                                <a href="javascript: void(0);">About</a>
                                <a href="javascript: void(0);">Support</a>
                                <a href="javascript: void(0);">Contact Us</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
            <!-- end Footer -->

        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->

    </div>
    <!-- END wrapper -->
    <div th:insert="~{partials/v3-fragments :: footer}"></div>
    <script type="text/javascript" th:src="@{/js/task.js}"></script>
    </body>
</html>